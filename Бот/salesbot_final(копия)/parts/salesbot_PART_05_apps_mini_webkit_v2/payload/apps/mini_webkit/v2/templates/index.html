
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ title }}</title>
  <link rel="stylesheet" href="/mini/static/style.css">
</head>
<body>
  <div class="wrap">
    <h1>{{ title }}</h1>
    <section class="card">
      <h2>Health</h2>
      <button onclick="ping()">Ping</button>
      <pre id="health_out"></pre>
    </section>

    <section class="card">
      <h2>CRM: Upsert Contact</h2>
      <input id="phone" placeholder="phone">
      <input id="email" placeholder="email">
      <input id="name" placeholder="name">
      <button onclick="upsert()">Upsert</button>
      <pre id="crm_out"></pre>
    </section>

    <section class="card">
      <h2>Voice: Run Pipeline</h2>
      <input type="file" id="audio">
      <button onclick="voice()">Run</button>
      <pre id="voice_out"></pre>
    </section>
  </div>

  <script>
    async function ping(){
      const r = await fetch('/mini/health');
      document.getElementById('health_out').textContent = JSON.stringify(await r.json(), null, 2);
    }
    async function upsert(){
      const phone = document.getElementById('phone').value;
      const email = document.getElementById('email').value;
      const name = document.getElementById('name').value;
      const r = await fetch('/mini/crm/upsert_contact?phone='+encodeURIComponent(phone)+'&email='+encodeURIComponent(email)+'&name='+encodeURIComponent(name), {method:'POST'});
      document.getElementById('crm_out').textContent = JSON.stringify(await r.json(), null, 2);
    }
    async function voice(){
      const f = document.getElementById('audio').files[0];
      const fd = new FormData();
      fd.append('file', f);
      const r = await fetch('/mini/voice/run', {method:'POST', body: fd});
      document.getElementById('voice_out').textContent = JSON.stringify(await r.json(), null, 2);
    }
  </script>
</body>
</html>
